<div id="workspace-setting-container">

  <form [formGroup]="workspaceEditForm" novalidate *ngIf="workspaceEditForm">
    <dl class="workspace-info grid mb-30">
      <dt>
        Workspace name
      </dt>
      <dd>
        <div class="preview" *ngIf="!isWorkspaceNameEditOn">
          <p>{{ workspace.name }}</p>
          <button mat-icon-button aria-label="edit" *ngIf="isEditable" (click)="editWorkspaceName()">
            <mat-icon fontSet="material-icons-outlined">mode_edit</mat-icon>
          </button>
        </div>
        <mat-form-field appearance="fill" *ngIf="isWorkspaceNameEditOn">
          <input matInput formControlName="name">
          <mat-error *ngIf="workspaceEditForm.controls.name.hasError('required')">
            <strong>Name is required</strong>
          </mat-error>
          <mat-error *ngIf="workspaceEditForm.controls.name.hasError('maxlength')">
            <strong>Max length (64 characters) exceeded</strong>
          </mat-error>
          <mat-error *ngIf="workspaceEditForm.controls.name.hasError('forbiddenValue')">
            <strong>Workspace name cannot start with "system"</strong>
          </mat-error>
        </mat-form-field>
      </dd>
      <dt>
        Workspace description
      </dt>
      <dd>
        <div class="preview" *ngIf="!isWorkspaceDescriptionEditOn">
          <p [innerHTML]="workspace.description || 'No description'"></p>
          <button mat-icon-button aria-label="edit" *ngIf="isEditable" (click)="editWorkspaceDescription()">
            <mat-icon fontSet="material-icons-outlined">mode_edit</mat-icon>
          </button>
        </div>
        <mat-form-field appearance="fill" *ngIf="isWorkspaceDescriptionEditOn">
          <textarea matInput formControlName="description"></textarea>
        </mat-form-field>
      </dd>
      <dt class="join-code-title">
        Join code
      </dt>
      <dd>
        <div>
          <button class="open-join-code-button" (click)="openJoinCodeDialog()">
            <mat-icon class="mr-5 txt__primary-light">vpn_key</mat-icon>
            <span class="chip__password center__v"></span>
          </button>
        </div>
      </dd>
      <dt>
        Created
      </dt>
      <dd>{{ workspace.create_ts | dateDisplay }}</dd>
      <dt>
        Expiring
      </dt>
      <dd>
        {{ workspace.expiry_ts | dateDisplay }}  ({{ workspace.expiry_ts | remainingDaysDisplay }})
        <span class="extend-checkbox" *ngIf="workspace.config?.allow_expiry_extension">
          <mat-checkbox formControlName="isExtendExpiryChecked" (click)="onExtendExpiryDateClick()">
            Extend to 13 months from now
          </mat-checkbox>
        </span>
      </dd>
      <dt>
        Memory limit
      </dt>
      <dd>{{ workspace.memory_limit_gib }} GiB total for concurrent sessions</dd>
      <ng-container class="pt-10 grid-col" *ngIf="workspace.membership_expiry_policy.kind==='activity_timeout'">
        <dt>Membership expiry</dt>
        <dd>after {{ workspace.membership_expiry_policy.timeout_days }} days of inactivity</dd>
      </ng-container>
    </dl>
    <div class="action-buttons">
      <button mat-flat-button class="workspace-update-button" color="accent"
              *ngIf="workspace.name!=='System.default'"
              [disabled]="!isWorkspaceFormChanged || !workspaceEditForm.valid" (click)="updateWorkspace()">
        save changes
      </button>
      <button mat-stroked-button class="workspace-edit-cancel-button" [disabled]="!isWorkspaceFormChanged"
              (click)="cancelWorkspaceEditing()">
        cancel changes
      </button>
      <button mat-stroked-button class="workspace-delete-button" *ngIf="isDeletable"
              (click)="deleteWorkspace()">
        <mat-icon fontSet="material-icons-outlined" class="mr-5">delete_outline</mat-icon>
        delete workspace
      </button>
    </div>
  </form>
</div>

<ng-template #loadingBlock>
  <section class="status-info-container">
    <div class="empty-status">
      <mat-icon fontSet="material-icons-outlined" class="md-96">hourglass_top</mat-icon>
      <span class="status-summary">...Loading...</span>
    </div>
  </section>
</ng-template>
